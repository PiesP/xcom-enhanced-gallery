#!/usr/bin/env sh

# =============================================================================
# Pre-push Hook for X.com Enhanced Gallery (Wave 2 Enhanced)
# =============================================================================
# Ensures code quality and stability before pushing to remote repositories.
# Wave 2: Enhanced with comprehensive validation pipeline
# =============================================================================

echo "ğŸ§ª Pre-push validation starting..."

# 1. ì „ì²´ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ ì‹¤í–‰
echo "ğŸ§ª Running full test suite..."
npm run test:ci || {
  echo "âŒ Tests failed. Push aborted."
  exit 1
}

# 2. íƒ€ì… ì²´í¬
echo "ğŸ“‹ Running type check..."
npm run typecheck || {
  echo "âŒ Type check failed. Push aborted."
  exit 1
}

# 3. ë¦°íŠ¸ ê²€ì‚¬
echo "ï¿½ Running lint check..."
npm run lint || {
  echo "âŒ Lint check failed. Push aborted."
  exit 1
}

# 4. ë¹Œë“œ ê²€ì¦
echo "ğŸ—ï¸ Running build validation..."
npm run build:all || {
  echo "âŒ Build failed. Push aborted."
  exit 1
}

# 5. ë²ˆë“¤ í¬ê¸° ê²€ì¦ (Wave 2 ì¶”ê°€)
echo "ğŸ“Š Checking bundle size..."
if command -v node >/dev/null 2>&1; then
  node scripts/build-metrics.js --check-size || {
    echo "âš ï¸ Bundle size warning (not blocking)"
  }
fi

# 6. Coverage ê²€ì¦ (Wave 2 ì¶”ê°€)
echo "ğŸ“ˆ Checking test coverage..."
npm run test:coverage || {
  echo "âš ï¸ Coverage check warning (not blocking)"
}

echo "âœ… Pre-push validation completed successfully!"
echo "ğŸš€ Ready to push!"
