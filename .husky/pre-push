#!/usr/bin/env sh
# Pre-push: Typecheck + Tests (configurable scope)
# CI: Skipped (full validation in GitHub Actions)
#
# Scope priority: XEG_PREPUSH_SCOPE (env) > xeg.prepushScope (git config) > smoke (default)
#
# Examples:
#   export XEG_PREPUSH_SCOPE=full && git push    # Full suite (one-time)
#   git config xeg.prepushScope fast             # Save preference
#   git push                                      # Use default (smoke)

[ "$CI" = "true" ] && exit 0

# Determine scope
SCOPE="${XEG_PREPUSH_SCOPE:-$(git config --get xeg.prepushScope 2>/dev/null || echo smoke)}"

echo "ðŸ§ª Pre-push: typecheck + tests (scope: $SCOPE)"

# Typecheck
npm run typecheck || exit 1

# Tests
case "$SCOPE" in
  full|all) npm test || exit 1 ;;
  *) npm run "test:$SCOPE" || exit 1 ;;
esac

echo "âœ… Pre-push passed"
