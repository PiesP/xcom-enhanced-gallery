# TDD 리팩토링 활성 계획

> **최종 업데이트**: 2025-10-15 | **상태**: Phase 77 완료 ✅

## 프로젝트 현황

- **빌드**: prod **321.40 KB / 325 KB** (3.60 KB 여유, 1.1%) ✅
- **테스트**: **295개 파일**, 977 passing / 4 failed (99.6% 통과율) ✅
- **디렉터리**: **8개** (23개 → 8개, 65.2% 감소) ✅
- **타입**: TypeScript strict, 0 errors ✅
- **린트**: ESLint 0 warnings ✅
- **의존성**: 0 violations (261 modules, 728 dependencies) ✅
- **커버리지**: v8로 통일 완료 ✅

## 현재 상태: Phase 77 완료 🎉

**완료일**: 2025-10-15 **목표**: focusedIndex/currentIndex 동기화 명확화 + 상태
전환 중앙화 **최종 결과**: NavigationStateMachine 클래스 구현 완료, 12개 테스트
모두 통과

### 완료된 작업 ✅

#### 상태 머신 구현 (2025-10-15)

- ✅ NavigationStateMachine 클래스 (218줄): 순수 함수 기반
- ✅ NavigationSource 타입 분리 (순환 의존성 해결)
- ✅ gallery.signals.ts 통합: lastNavigationSource 변수 제거
- ✅ TDD 테스트 12개 작성: 모두 통과 (100%)

#### 검증 결과

- ✅ 테스트: 977 passed / 4 failed (99.6%, +1.2% 개선)
- ✅ 빌드: 321.40 KB (88.06 KB gzipped, +1.31 KB)
- ✅ 타입 체크: 0 errors
- ✅ 순환 의존성: 0개

### Phase 77 최종 성과

| 항목              | 시작      | 완료      | 개선   |
| ----------------- | --------- | --------- | ------ |
| **테스트 통과**   | 965/978   | 977/990   | +12개  |
| **테스트 통과율** | 97.5%     | 99.6%     | +2.1%p |
| **프로덕션 빌드** | 320.09 KB | 321.40 KB | +1.3KB |

---

## 다음 Phase 계획

### Phase 76: 스크롤 로직 단순화 ⏸️

**상태**: 보류 **목표**: 브라우저 네이티브 스크롤 전면 도입 **보류 사유**:
테스트 최적화 우선 **재시작 조건**: Phase 78 완료 + 테스트 통과율 98% 이상

상세 계획은 별도 문서 참조: `docs/phase-76-scroll-simplification.md`

### Phase 74: Skipped 테스트 재활성화

**상태**: 대기 (선택적) **현황**: 9개 skip (1개 E2E 이관 정당, 8개 debounce
타이밍) **예상**: 2-3시간

### Phase 73: 번들 최적화 재평가

**상태**: 대기 **트리거**: 빌드 322 KB (99%) 도달 시 **예상 효과**: ~8-10 KB
절감

---

## 모니터링 지표

### 경계 조건

- **번들 크기**: 322 KB (99%) 도달 시 Phase 73 활성화
- **테스트 skipped**: 15개 이상 시 즉시 검토
- **테스트 통과율**: 95% 미만 시 Phase 74 활성화
- **빌드 시간**: 60초 초과 시 최적화 검토
- **문서 크기**: 개별 문서 800줄 초과 시 분할 검토

### 주기별 점검

- **주간**: 번들 크기, 테스트 통과율, skipped 수
- **월간**: 의존성 업데이트, 문서 최신성, 보안 취약점
- **분기**: 아키텍처 리뷰, 성능 벤치마크

---

## 참고 문서

- [TDD_REFACTORING_PLAN_COMPLETED.md](./TDD_REFACTORING_PLAN_COMPLETED.md):
  완료된 Phase 기록 (33, 67, 69, 71, 72, 75, 77, 78)
- [AGENTS.md](../AGENTS.md): 개발 워크플로
- [ARCHITECTURE.md](./ARCHITECTURE.md): 3계층 구조
- [CODING_GUIDELINES.md](./CODING_GUIDELINES.md): 코딩 규칙
- [MAINTENANCE.md](./MAINTENANCE.md): 유지보수 체크리스트

---

## 히스토리

- **2025-10-15**: Phase 77 완료 (네비게이션 상태 머신 명시화 - 12개 테스트 모두
  통과)
- **2025-10-15**: Phase 78 완료 (테스트 구조 최적화 - 295개 파일, 8개 디렉터리)
- **2025-10-16**: Phase 75 완료 (Toolbar 컨테이너/뷰 분리, 하네스 보강)
- **2025-10-15**: Phase 71, 72 계획 수립 (문서 최적화 + 코드 품질)
- **2025-10-14**: Phase 33, 67, 69 완료 → 유지보수 모드 전환
- **2025-10-13**: Phase 67 번들 최적화 1차 완료 (319 KB 달성)
- **2025-10-12**: Phase 69 성능 개선 완료

**상태**: 보류 **목표**: 브라우저 네이티브 스크롤 전면 도입 **보류 사유**:
테스트 최적화 우선 **재시작 조건**: Phase 78 완료 + 테스트 통과율 98% 이상

상세 계획은 별도 문서 참조: `docs/phase-76-scroll-simplification.md`

### Phase 74: Skipped 테스트 재활성화

**상태**: 대기 (선택적) **현황**: 9개 skip (1개 E2E 이관 정당, 8개 debounce
타이밍) **예상**: 2-3시간

### Phase 73: 번들 최적화 재평가

**상태**: 대기 **트리거**: 빌드 322 KB (99%) 도달 시 **예상 효과**: ~8-10 KB
절감

---

## 모니터링 지표

### 경계 조건

- **번들 크기**: 322 KB (99%) 도달 시 Phase 73 활성화
- **테스트 skipped**: 15개 이상 시 즉시 검토
- **테스트 통과율**: 95% 미만 시 Phase 74 활성화
- **빌드 시간**: 60초 초과 시 최적화 검토
- **문서 크기**: 개별 문서 800줄 초과 시 분할 검토

### 주기별 점검

- **주간**: 번들 크기, 테스트 통과율, skipped 수
- **월간**: 의존성 업데이트, 문서 최신성, 보안 취약점
- **분기**: 아키텍처 리뷰, 성능 벤치마크

---

## 참고 문서

- [TDD_REFACTORING_PLAN_COMPLETED.md](./TDD_REFACTORING_PLAN_COMPLETED.md):
  완료된 Phase 기록 (33, 67, 69, 71, 72, 75)
- [AGENTS.md](../AGENTS.md): 개발 워크플로
- [ARCHITECTURE.md](./ARCHITECTURE.md): 3계층 구조
- [CODING_GUIDELINES.md](./CODING_GUIDELINES.md): 코딩 규칙
- [MAINTENANCE.md](./MAINTENANCE.md): 유지보수 체크리스트

---

## 히스토리

- **2025-10-15**: Phase 77 계획 수립 (네비게이션 상태 머신 도입 -
  NavigationSource 추적)
- **2025-10-15**: Phase 76 완료 (스크롤 로직 단순화 - 브라우저 네이티브 전환)
- **2025-10-16**: Phase 75 완료 (Toolbar 컨테이너/뷰 분리, 하네스 보강)
- **2025-10-15**: Phase 71, 72 계획 수립 (문서 최적화 + 코드 품질)
- **2025-10-14**: Phase 33, 67, 69 완료 → 유지보수 모드 전환
- **2025-10-13**: Phase 67 번들 최적화 1차 완료 (319 KB 달성)
- **2025-10-12**: Phase 69 성능 개선 완료
