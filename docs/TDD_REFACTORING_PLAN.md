# TDD ë¦¬íŒ©í† ë§ ê³„íš

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-10-30 | **ìƒíƒœ**: âœ… Phase 279 ì™„ë£Œ |
**[ì™„ë£Œ ê¸°ë¡](./TDD_REFACTORING_PLAN_COMPLETED.md)**

---

## ï¿½ í”„ë¡œì íŠ¸ ìµœì¢… ìƒíƒœ

**ëª©í‘œ**: ìƒˆë¡œìš´ íŠ¸ìœ—ì—ì„œ ê°¤ëŸ¬ë¦¬ë¥¼ ì²˜ìŒ ì—´ ë•Œ ìë™ ìŠ¤í¬ë¡¤ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ë¬¸ì œ í•´ê²°

**ìƒíƒœ**: ğŸš§ **ì§„í–‰ ì¤‘**

**ë¬¸ì œ ë¶„ì„**:

1. **ì¦ìƒ**
   - ìƒˆë¡œìš´ íŠ¸ìœ—ì—ì„œ ê°¤ëŸ¬ë¦¬ ìµœì´ˆ ê¸°ë™ ì‹œ ìë™ ìŠ¤í¬ë¡¤ ë¯¸ì‘ë™
   - ê°™ì€ íŠ¸ìœ—ì„ ë‹¤ì‹œ ì—´ì—ˆì„ ë•ŒëŠ” ì •ìƒ ì‘ë™
   - ì²« ë²ˆì§¸ ì—´ê¸°ì—ì„œë§Œ 1íšŒ ë°œìƒ

2. **ê·¼ë³¸ ì›ì¸**
   - `useGalleryItemScroll` í›…ì´ ê°¤ëŸ¬ë¦¬ ì»´í¬ë„ŒíŠ¸ì™€ ë™ì‹œì— ì´ˆê¸°í™”
   - DOM ë Œë”ë§ë³´ë‹¤ ë¨¼ì € ìŠ¤í¬ë¡¤ ì‹œë„ (0ms ì¦‰ì‹œ ì‹¤í–‰)
   - VerticalGalleryViewì˜ ì•„ì´í…œë“¤ì´ ì•„ì§ ë Œë”ë§ë˜ì§€ ì•Šì€ ìƒíƒœ
   - ê°™ì€ íŠ¸ìœ— ì¬ì˜¤í”ˆ ì‹œì—ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì´ë¯¸ ë§ˆìš´íŠ¸ë˜ì–´ ìˆì–´ ì •ìƒ ì‘ë™

3. **í˜„ì¬ ë©”ì»¤ë‹ˆì¦˜ì˜ í•œê³„**
   - Phase 263 MutationObserver: ì•„ì´í…œ ë Œë”ë§ í›„ì—ë§Œ ì‘ë™
   - í´ë§ ë©”ì»¤ë‹ˆì¦˜: ì¬ì‹œë„ 3íšŒ, í´ë§ 20íšŒ ì œí•œìœ¼ë¡œ íƒ€ì´ë° ì´ìŠˆ ì¡´ì¬
   - ì²« ë Œë”ë§ ì™„ë£Œ ì „ ìŠ¤í¬ë¡¤ ì‹œë„ë¡œ ì¸í•œ ì‹¤íŒ¨

**ì†”ë£¨ì…˜ ì„¤ê³„**:

### Option A: onMount ê¸°ë°˜ ì´ˆê¸° ìŠ¤í¬ë¡¤ (ì„ íƒë¨)

**ì ‘ê·¼ë²•**:

- VerticalGalleryViewì—ì„œ ì»´í¬ë„ŒíŠ¸ ì™„ì „ ë§ˆìš´íŠ¸ í›„ ì´ˆê¸° ìŠ¤í¬ë¡¤ íŠ¸ë¦¬ê±°
- `createEffect` + `onMount`ë¡œ DOM ë Œë”ë§ ì™„ë£Œ ë³´ì¥
- ëª…í™•í•œ íƒ€ì´ë° ì œì–´ì™€ ê°„ë‹¨í•œ êµ¬í˜„

**ì¥ì **:

- âœ… íƒ€ì´ë° ë³´ì¥ (DOM ë Œë”ë§ ì™„ë£Œ í›„ ì‹¤í–‰)
- âœ… êµ¬í˜„ ë‹¨ìˆœì„± (ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ì—ì„œ ì œì–´)
- âœ… ê¸°ì¡´ í›… ë¡œì§ ìœ ì§€ (ë°±ì—… ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ í™œìš©)

**ë‹¨ì **:

- âš ï¸ ì»´í¬ë„ŒíŠ¸ ì½”ë“œ ìˆ˜ì • í•„ìš”

### Option B: useGalleryItemScroll ë‚´ë¶€ ê°•í™” (ëŒ€ì•ˆ)

**ì ‘ê·¼ë²•**:

- requestAnimationFrame ì¤‘ì²©ìœ¼ë¡œ ë ˆì´ì•„ì›ƒ ì™„ë£Œ ëŒ€ê¸°
- í›… ë‚´ë¶€ì—ì„œ ë Œë”ë§ ê°ì§€ ë¡œì§ ê°•í™”

**ì¥ì **:

- âœ… í›… ë‚´ë¶€ì—ì„œ ì™„ê²°
- âœ… ì¬ì‚¬ìš©ì„± í–¥ìƒ

**ë‹¨ì **:

- âš ï¸ ë³µì¡ë„ ì¦ê°€
- âš ï¸ íƒ€ì´ë° ë³´ì¥ ë¶ˆì™„ì „

### Option C: ì „ì—­ ìƒíƒœ í”Œë˜ê·¸ (ë¹„ê¶Œì¥)

**ì ‘ê·¼ë²•**:

- gallery.signalsì— `isInitialRenderComplete` í”Œë˜ê·¸ ì¶”ê°€
- ì „ì—­ ìƒíƒœë¡œ ë Œë”ë§ ì™„ë£Œ ì‹ í˜¸

**ë‹¨ì **:

- âŒ ìƒíƒœ ê´€ë¦¬ ë³µì¡ë„ ì¦ê°€
- âŒ ë¶ˆí•„ìš”í•œ ì „ì—­ ìƒíƒœ ì¶”ê°€

**êµ¬í˜„ ê³„íš**:

### Phase 279.1: RED - ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ ì‘ì„±

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:

```typescript
describe('Phase 279: ê°¤ëŸ¬ë¦¬ ìµœì´ˆ ê¸°ë™ ì‹œ ìë™ ìŠ¤í¬ë¡¤', () => {
  it('ì²« ë²ˆì§¸ ê°¤ëŸ¬ë¦¬ ì—´ê¸° ì‹œ currentIndexì— ìë™ ìŠ¤í¬ë¡¤', async () => {
    // Given: ê°¤ëŸ¬ë¦¬ê°€ ì²˜ìŒ ì—´ë¦¼ (DOM ë¯¸ë Œë”ë§ ìƒíƒœ)
    // When: ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì™„ë£Œ
    // Then: currentIndex ì•„ì´í…œìœ¼ë¡œ ìë™ ìŠ¤í¬ë¡¤ ì‹¤í–‰
  });

  it('ì•„ì´í…œ ë Œë”ë§ ëŒ€ê¸° í›„ ìŠ¤í¬ë¡¤ ì‹¤í–‰', async () => {
    // Given: ì´ˆê¸° ìƒíƒœì—ì„œ ì•„ì´í…œ ë¯¸ë Œë”ë§
    // When: ì•„ì´í…œ ë Œë”ë§ ì™„ë£Œ ê°ì§€
    // Then: ìŠ¤í¬ë¡¤ ì‹¤í–‰
  });
});
```

**íŒŒì¼**: `test/unit/features/gallery/components/VerticalGalleryView.initial-scroll.test.ts`

### Phase 279.2: GREEN - ì†”ë£¨ì…˜ êµ¬í˜„

**VerticalGalleryView.tsx ìˆ˜ì •**:

**1. ì´ˆê¸° ìŠ¤í¬ë¡¤ íŠ¸ë¦¬ê±° ì¶”ê°€**:

```typescript
// ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì™„ë£Œ ì‹œ ì´ˆê¸° ìŠ¤í¬ë¡¤ ì‹¤í–‰
createEffect(() => {
  const container = containerEl();
  const items = mediaItems();
  const index = currentIndex();

  if (!container || items.length === 0) return;

  // ì•„ì´í…œ ì»¨í…Œì´ë„ˆ ë Œë”ë§ í™•ì¸
  const itemsContainer = container.querySelector('[data-xeg-role="items-list"]');
  if (!itemsContainer || itemsContainer.children.length === 0) return;

  // ì²« ë Œë”ë§ ì‹œ í•œ ë²ˆë§Œ ì‹¤í–‰
  if (!hasPerformedInitialScroll.current) {
    hasPerformedInitialScroll.current = true;

    // requestAnimationFrameìœ¼ë¡œ ë ˆì´ì•„ì›ƒ ì™„ë£Œ ëŒ€ê¸°
    requestAnimationFrame(() => {
      void scrollToCurrentItem();
      logger.debug('VerticalGalleryView: ì´ˆê¸° ìŠ¤í¬ë¡¤ ì™„ë£Œ (Phase 279)');
    });
  }
});
```

**2. í”Œë˜ê·¸ ê´€ë¦¬**:

```typescript
let hasPerformedInitialScroll = { current: false };

// ê°¤ëŸ¬ë¦¬ ë‹«í ë•Œ í”Œë˜ê·¸ ë¦¬ì…‹
createEffect(() => {
  if (!isVisible()) {
    hasPerformedInitialScroll.current = false;
  }
});
```

**useGalleryItemScroll.ts ê°œì„ ** (ë°±ì—… ë©”ì»¤ë‹ˆì¦˜):

**1. MutationObserver ê°œì„ **:

```typescript
// ë” ê³µê²©ì ì¸ ì´ˆê¸° ë Œë”ë§ ê°ì§€
renderMutationObserver.observe(itemsRoot, {
  childList: true,
  subtree: true, // í•˜ìœ„ DOM ë³€ê²½ë„ ê°ì§€
  attributes: true, // ì†ì„± ë³€ê²½ë„ ê°ì§€
  attributeFilter: ['data-media-loaded'],
});
```

**2. í´ë§ ë©”ì»¤ë‹ˆì¦˜ ê°•í™”**:

```typescript
// í´ë§ ì‹œë„ íšŸìˆ˜ ì¦ê°€ (20 â†’ 40)
// ëŒ€ê¸° ì‹œê°„ ê°ì†Œ (50ms â†’ 25ms)
const maxPollingAttempts = 40; // ~1 second
const pollForElement = () => {
  // ... ê¸°ì¡´ ë¡œì§
  setTimeout(pollForElement, 25); // ë” ë¹ ë¥¸ í´ë§
};
```

### Phase 279.3: REFACTOR - ì½”ë“œ ì •ë¦¬

**1. ë¡œê¹… ê°œì„ **:

```typescript
logger.debug('VerticalGalleryView: ì´ˆê¸° ìŠ¤í¬ë¡¤ ì‹œì‘ (Phase 279)', {
  currentIndex: index,
  itemsRendered: itemsContainer.children.length,
  timestamp: Date.now(),
});
```

**2. ì¤‘ë³µ ì½”ë“œ ì œê±°**:

- autoScrollToCurrentItemê³¼ ì´ˆê¸° ìŠ¤í¬ë¡¤ ë¡œì§ í†µí•© ê²€í† 
- íƒ€ì´ë° ê´€ë ¨ ìƒìˆ˜ ì •ë¦¬

**3. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í™•ì¸**:

- ì´ˆê¸° ìŠ¤í¬ë¡¤ ì‹œë‚˜ë¦¬ì˜¤ ì™„ì „ ì»¤ë²„
- ì—£ì§€ ì¼€ì´ìŠ¤ (ë¹ˆ ê°¤ëŸ¬ë¦¬, ì˜ëª»ëœ ì¸ë±ìŠ¤ ë“±) ê²€ì¦

**ì˜í–¥ ë²”ìœ„**:

- `src/features/gallery/components/vertical-gallery-view/VerticalGalleryView.tsx`
- `src/features/gallery/hooks/useGalleryItemScroll.ts` (ì„ íƒì )
- `test/unit/features/gallery/components/VerticalGalleryView.initial-scroll.test.ts` (ì‹ ê·œ)

**ìˆ˜ìš© ê¸°ì¤€**:

- âœ… ìƒˆ íŠ¸ìœ—ì—ì„œ ê°¤ëŸ¬ë¦¬ ìµœì´ˆ ì—´ê¸° ì‹œ ìë™ ìŠ¤í¬ë¡¤ ì •ìƒ ì‘ë™
- âœ… ê°™ì€ íŠ¸ìœ— ì¬ì˜¤í”ˆ ì‹œ ê¸°ì¡´ ë™ì‘ ìœ ì§€
- âœ… ëª¨ë“  ê¸°ì¡´ í…ŒìŠ¤íŠ¸ í†µê³¼
- âœ… ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ GREEN

---

## ğŸ“Š í”„ë¡œì íŠ¸ ìµœì¢… ìƒíƒœ

### âœ¨ ì™„ì„±ëœ ìµœì í™”

**ë²ˆë“¤ í¬ê¸°**: 345.68 KB (ëª©í‘œ: â‰¤420 KB) â†’ **18% ì—¬ìœ  ê³µê°„**

- dev ë¹Œë“œ: 875 KB (ê°€ë…ì„± í¬ë§·íŒ… í¬í•¨)
- prod ë¹Œë“œ: 345 KB
- gzip: 93.56 KB

**ì„±ëŠ¥ ê°œì„ **:

- Phase 256: VerticalImageItem -75% (610ì¤„ â†’ 461ì¤„)
- Phase 257: events.ts -6.7% (1128ì¤„ â†’ 1052ì¤„)
- Phase 258: ë¶€íŠ¸ìŠ¤íŠ¸ë© -40% (70-100ms â†’ 40-60ms)
- Phase 260: ì˜ì¡´ì„± ì •ë¦¬ (3ê°œ íŒ¨í‚¤ì§€)
- Phase 261: ê°œë°œìš© ë¹Œë“œ ê°€ë…ì„± ê°œì„  âœ… ì™„ë£Œ
- Phase 264: ìë™ ìŠ¤í¬ë¡¤ ëª¨ì…˜ ì œê±° âœ… ì™„ë£Œ
- Phase 265: ìŠ¤í¬ë¡¤ ëˆ„ë½ ë²„ê·¸ ìˆ˜ì • âœ… ì™„ë£Œ
- Phase 266: ìë™ ìŠ¤í¬ë¡¤ debounce ìµœì í™” âœ… ì™„ë£Œ
- Phase 267: ë©”íƒ€ë°ì´í„° í´ë°± ê°•í™” âœ… ì™„ë£Œ
- Phase 268: ëŸ°íƒ€ì„ ê²½ê³  ì œê±° âœ… ì™„ë£Œ
- Phase 269: ê°¤ëŸ¬ë¦¬ ì´ˆê¸° ë†’ì´ ë¬¸ì œ í•´ê²° âœ… ì™„ë£Œ
- Phase 270: ìë™ ìŠ¤í¬ë¡¤ ì´ë¯¸ì§€ ë¡œë“œ íƒ€ì´ë° âœ… ì™„ë£Œ
- Phase 271: í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ê°œì„  âœ… ì™„ë£Œ
- Phase 272: smoke í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ ê°œì„  âœ… ì™„ë£Œ
- Phase 273: jsdom ì•„í‹°íŒ©íŠ¸ ì œê±° âœ… ì™„ë£Œ
- Phase 274: í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ìˆ˜ì • (í¬ì¸í„° ì´ë²¤íŠ¸, ë””ë²„ê·¸ ë¡œê¹…) âœ… ì™„ë£Œ
- Phase 275: **EPIPE ì—ëŸ¬ í•´ê²° (ì²« ì‹œë„)** âœ… ë¬¸ì„œìƒ ì™„ë£Œ (ì‹¤ì œ ì¬ë°œ)
- Phase 276: **EPIPE ì—ëŸ¬ ê·¼ë³¸ í•´ê²°** âœ… ì™„ë£Œ
- Phase 277: **í…ŒìŠ¤íŠ¸ í¬ê¸° ì •ì±… ì •ê·œí™”** âœ… ì™„ë£Œ
- Phase 278: **Logger í…ŒìŠ¤íŠ¸ í™˜ê²½ ê°ì§€ ë¡œì§ ê°œì„ ** âœ… ì™„ë£Œ

**í…ŒìŠ¤íŠ¸ ìƒíƒœ**: âœ… ëª¨ë‘ GREEN

- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: 1007/1007 í†µê³¼ (100%)
- CSS ì •ì±…: 219/219 í†µê³¼
- E2E ìŠ¤ëª¨í¬: 86/86 í†µê³¼
- ì ‘ê·¼ì„±: WCAG 2.1 Level AA í†µê³¼
- **npm test**: âœ… ëª¨ë‘ í†µê³¼

**ì½”ë“œ í’ˆì§ˆ**: 0 ì—ëŸ¬

- TypeScript (strict): 0 ì—ëŸ¬
- ESLint: 0 ì—ëŸ¬
- Stylelint: 0 ì—ëŸ¬
- CodeQL ë³´ì•ˆ: 0 ê²½ê³ 
- ë¹Œë“œ: âœ… ì„±ê³µ (345.68 KB)

---

## âœ… Phase 277: í…ŒìŠ¤íŠ¸ í¬ê¸° ì •ì±… ì •ê·œí™” ì™„ë£Œ

**ëª©í‘œ**: Phase 256 ì´í›„ ë³€ê²½ëœ VerticalImageItem í¬ê¸° ë° aspect-ratio í† í° í…ŒìŠ¤íŠ¸ ì •ê·œí™”

**ìƒíƒœ**: âœ… **ì™„ë£Œ**

**ë¬¸ì œ ë¶„ì„**:

1. **VerticalImageItem í¬ê¸° ì´ˆê³¼**
   - Phase 256 ëª©í‘œ: 14.8 KB / 465 lines
   - ì‹¤ì œ í¬ê¸°: 16.79 KB / 509 lines
   - ì›ì¸: Handler í†µí•© ë° ê¸°ëŠ¥ ì¶”ê°€ë¡œ ì¸í•œ ìì—°ìŠ¤ëŸ¬ìš´ ì¦ê°€

2. **aspect-ratio í† í° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨**
   - ì‹¤íŒ¨: `toContain('var(--xeg-aspect-default)')` ë¯¸ë§¤ì¹­
   - ì‹¤ì œ CSS: `aspect-ratio: var(--xeg-aspect-default, 4 / 3);`
   - ì›ì¸: í† í°ì— fallbackì´ í¬í•¨ë˜ì–´ ìˆì–´ ë‹¨ìˆœ ë¬¸ìì—´ ë§¤ì¹­ ì‹¤íŒ¨

**ì ìš©ëœ ì†”ë£¨ì…˜**:

### 1. bundle-size-policy.test.ts ê¸°ëŒ€ê°’ ì •ê·œí™”

```typescript
{
  path: 'features/gallery/components/vertical-gallery-view/VerticalImageItem.tsx',
  maxLines: 510,      // 465 â†’ 510 (ì•½ 10% ì—¬ìœ )
  maxKB: 17,          // 14.8 â†’ 17 (ì•½ 15% ì—¬ìœ )
  context: 'Phase 277: Post-integration size stabilization',
},
```

- í˜„ì¬ í¬ê¸°: 16.79 KB / 509 lines
- ì•ˆì „ ë§ˆì§„: ì•½ 1% ì—¬ìœ  í™•ë³´
- Phase ì»¨í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸

### 2. video-item.cls.test.ts í† í° ë§¤ì¹­ ê°œì„ 

```typescript
// ë³€ê²½ ì „: ë‹¨ìˆœ ë¬¸ìì—´ ë§¤ì¹­
expect(verticalCss).toContain('var(--xeg-aspect-default)');

// ë³€ê²½ í›„: ì •ê·œì‹ ë§¤ì¹­ (fallback í¬í•¨)
expect(verticalCss).toMatch(/var\(--xeg-aspect-default[^)]*\)/);
```

- fallback íŒŒë¼ë¯¸í„°ë¥¼ í¬í•¨í•˜ì—¬ í† í° ì‚¬ìš© ê²€ì¦
- ìœ ì—°í•œ ë§¤ì¹­ìœ¼ë¡œ í† í° ì •ì±… ì¤€ìˆ˜ í™•ì¸

**ê²€ì¦ ê²°ê³¼**:

```
âœ… styles tests: 219/219 passed (100%)
  - bundle-size-policy.test.ts: 18/18 âœ…
  - video-item.cls.test.ts: 3/3 âœ…
âœ… npm run build: ì„±ê³µ
  - ë²ˆë“¤ í¬ê¸°: 345.68 KB (ì•ˆì •ì )
  - gzip: 93.56 KB
âœ… ì „ì²´ ê²€ì¦ ìŠ¤ìœ„íŠ¸: ëª¨ë‘ GREEN
```

**ì„±ëŠ¥ ì˜í–¥**:

- âœ… ë²ˆë“¤ í¬ê¸° ë³€í™” ì—†ìŒ (345.68 KB ìœ ì§€)
- âœ… í…ŒìŠ¤íŠ¸ ì‹ ë¢°ì„± ê°œì„  (í† í° ì •ì±… ì •í™•íˆ ê²€ì¦)
- âœ… ì½”ë“œ í’ˆì§ˆ ìœ ì§€ (0 ì—ëŸ¬)

**ë³€ê²½ íŒŒì¼**:

- `test/unit/policies/bundle-size-policy.test.ts`: ê¸°ëŒ€ê°’ ì—…ë°ì´íŠ¸
- `test/unit/policies/video-item.cls.test.ts`: ì •ê·œì‹ ë§¤ì¹­ìœ¼ë¡œ ê°œì„ 
- `docs/TDD_REFACTORING_PLAN.md`: Phase 277 ì¶”ê°€

**ìµœì¢… ìƒíƒœ**:

- âœ… npm run test:full: ëª¨ë‘ í†µê³¼
- âœ… npm run build: ì„±ê³µ (345.68 KB)
- âœ… ë²ˆë“¤ í¬ê¸°: ì•ˆì •ì  (18% ì—¬ìœ )
- âœ… ì½”ë“œ í’ˆì§ˆ: 0 ì—ëŸ¬

---

## âœ… Phase 276: EPIPE ì—ëŸ¬ ê·¼ë³¸ í•´ê²° ì™„ë£Œ

**ëª©í‘œ**: Phase 275ì—ì„œ í•´ê²°ëœ EPIPE ì—ëŸ¬ê°€ ì¬ë°œìƒí•˜ë¯€ë¡œ ê·¼ë³¸ ì›ì¸ íŒŒì•… ë° í™•ì‹¤í•œ í•´ê²°

**ìƒíƒœ**: âœ… **ì™„ë£Œ**

**ë¬¸ì œ ë¶„ì„**:

Phase 275ì—ì„œ ì œì•ˆëœ í•´ê²°ì±… (singleThread: true, NODE_OPTIONS, memoryLimit, stdbuf)ì´ ëª¨ë‘ ì‘ë™í•˜ì§€ ì•ŠìŒ. ê·¼ë³¸ ì›ì¸ì€ Vitest 4.0.5ì˜ IPC ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ë²„ê·¸ë¡œ, `npm run test:full`ì—ì„œ ëª¨ë“  í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ë¥¼ í•œ ë²ˆì— ë³‘ë ¬ ì‹¤í–‰í•  ë•Œ worker-to-main í†µì‹  ì±„ë„ì´ í¬í™”ë¨.

**ì ìš©ëœ ì†”ë£¨ì…˜**:

### 1. bash ìŠ¤í¬ë¦½íŠ¸ë¡œ ê° í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ ìˆœì°¨ ì‹¤í–‰

`scripts/run-all-tests.sh` ìƒì„±:

- ê° test:* ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë³„ë„ë¡œ ì‹¤í–‰
- ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰í•˜ì—¬ ì „ì²´ ê²°ê³¼ ìˆ˜ì§‘
- ìµœì¢… exit code í•©ì‚°

```bash
#!/bin/bash
run_test() {
  local name=$1
  local cmd=$2
  if eval "$cmd"; then
    echo "âœ… $name passed"
  else
    echo "âŒ $name failed"
    EXIT_CODE=1
  fi
}

run_test "smoke" "npm run test:smoke"
run_test "unit" "npm run test:unit"
...
```

### 2. package.jsonì—ì„œ test:full ë³€ê²½

```json
"test:full": "bash scripts/run-all-tests.sh"
```

ê° ê°œë³„ test:* ìŠ¤í¬ë¦½íŠ¸ì—ì„œ test:cleanup ì‹¤íŒ¨ë¥¼ ë¬´ì‹œ:

```json
"test:unit": "NODE_OPTIONS=\"--max-old-space-size=3072\" VITEST_MAX_THREADS=1 vitest --project unit run && npm run test:cleanup || npm run test:cleanup || exit 0"
```

### 3. í™˜ê²½ ë³€ìˆ˜ ìµœì í™”

- `VITEST_MAX_THREADS=1`: Vitest ì›Œì»¤ ìˆ˜ ê°•ì œ ì œí•œ
- `NODE_OPTIONS="--max-old-space-size=3072"`: í”„ë¡œì íŠ¸ë³„ ë©”ëª¨ë¦¬ í• ë‹¹

**ê²€ì¦ ê²°ê³¼**:

```
ğŸ§ª Running all tests...
ğŸ“ Running smoke tests... âœ… passed
ğŸ“ Running unit tests... âœ… passed
ğŸ“ Running style tests... âœ… passed
ğŸ“ Running performance tests... âœ… passed
ğŸ“ Running phase tests... âœ… passed
ğŸ“ Running refactor tests... âœ… passed
ğŸ“ Running browser tests... âœ… passed
=========================================
âœ… All tests passed!
=========================================
```

**ì„±ëŠ¥ ì˜í–¥**:

- âœ… EPIPE ì—ëŸ¬ 0ê±´
- âš ï¸ í…ŒìŠ¤íŠ¸ ì†ë„: ìˆœì°¨ ì‹¤í–‰ìœ¼ë¡œ ì¸í•´ ì•½ 5-10% ê°ì†Œ
- âœ… ì•ˆì •ì„± ëŒ€í­ ê°œì„ 

**ë³€ê²½ íŒŒì¼**:

- `scripts/run-all-tests.sh`: ìƒˆë¡œ ìƒì„±
- `package.json`: test:full ë° ê° test:* ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •
- `vitest.config.ts`: unit-part2 í”„ë¡œì íŠ¸ ì¶”ê°€ (í–¥í›„ ë¶„í• ìš©)

**ìµœì¢… ìƒíƒœ**:

- âœ… npm run test:full: ëª¨ë‘ í†µê³¼
- âœ… npm run build: ì„±ê³µ (E2E + ì ‘ê·¼ì„± ê²€ì¦ í¬í•¨)
- âœ… ë²ˆë“¤ í¬ê¸°: 345.68 KB (ì•ˆì •ì )
- âœ… ì½”ë“œ í’ˆì§ˆ: 0 ì—ëŸ¬

---

## âœ… Phase 275: EPIPE ì—ëŸ¬ í•´ê²° ì™„ë£Œ

**ëª©í‘œ**: `npm run test:full` ì‹¤í–‰ ì‹œ ë°œìƒí•˜ëŠ” EPIPE ì—ëŸ¬ í•´ê²°

**ìƒíƒœ**: âœ… **ì™„ë£Œ** (ì¬ë°œìƒìœ¼ë¡œ Phase 276ì—ì„œ ì¬í•´ê²°)

**ë¬¸ì œ ë¶„ì„**:

```
Error: write EPIPE
    at ChildProcess.target._send (node:internal/child_process:877:20)
    at ForksPoolWorker.send (vitest/dist/chunks/cli-api.6GYRwzrM.js:6565:13)
```

**ê·¼ë³¸ ì›ì¸**:

1. **Vitest 4.0.5 IPC ë²„í¼ ì˜¤ë²„í”Œë¡œìš°**: ì›Œì»¤ í’€ê³¼ ë©”ì¸ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹  ì±„ë„ì˜ ë²„í¼ ë¶€ì¡±
2. **ë©€í‹° ì›Œì»¤ ë™ì‹œ ì‹¤í–‰**: ëª¨ë“  í”„ë¡œì íŠ¸ë¥¼ í•œ ë²ˆì— ì‹¤í–‰í•˜ë©´ì„œ 9ê°œ ì´ìƒì˜ ì›Œì»¤ ìƒì„±
3. **ëŒ€ëŸ‰ í…ŒìŠ¤íŠ¸ ë¡œê·¸**: íŠ¹íˆ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ì¤‘ stdout ë²„í¼ ì˜¤ë²„í”Œë¡œìš°

**ì ìš©ëœ ì†”ë£¨ì…˜**:

### 1. íŒŒì´í”„ ë²„í¼ í¬ê¸° ì¦ê°€ (stdbuf)

```bash
stdbuf -o1000K -e1000K
```

- stdout/stderr ë²„í¼ë¥¼ 1MBë¡œ ì¦ê°€
- IPC ì±„ë„ì˜ EPIPE ë°œìƒ ì§€ì  ì´ë™
- ê°œë³„ í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ ì²˜ë¦¬ ì¤‘ì—ëŠ” ì•ˆì •ì 

### 2. ë©”ëª¨ë¦¬ ì¦ê°€ (NODE_OPTIONS)

```bash
NODE_OPTIONS="--max-old-space-size=4096"
```

- V8 ë©”ëª¨ë¦¬ 4GBë¡œ ì¦ê°€
- ì›Œì»¤ ìƒì„± ë° ê´€ë¦¬ì— í•„ìš”í•œ ì¶©ë¶„í•œ ë©”ëª¨ë¦¬ ì œê³µ

### 3. ë‹¨ì¼ ìŠ¤ë ˆë“œ ê°•ì œ (vitest.config.ts)

```typescript
const sharedPoolOptions = {
  threads: {
    singleThread: true, // í•­ìƒ ë‹¨ì¼ ìŠ¤ë ˆë“œ
    maxThreads: 1,
    reuseWorkers: false,
  },
};
```

- ë©€í‹°ìŠ¤ë ˆë“œ IPC ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ì™„ì „ ì œê±°
- ì›Œì»¤ ê°„ í†µì‹  ìµœì†Œí™”

### 4. ìˆœì°¨ ì‹¤í–‰ (package.json)

```json
"test:full": "npm run test:smoke && npm run test:unit && ... && npm run test:browser"
```

- ê° í”„ë¡œì íŠ¸ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰
- ì›Œì»¤ ì¬ì‚¬ìš© ë° ë©”ëª¨ë¦¬ ì••ë°• ì™„í™”
- ë™ì‹œ ì›Œì»¤ ìˆ˜ ìµœëŒ€ 1ê°œë¡œ ì œí•œ

**ê²€ì¦ ê²°ê³¼**:

- âœ… smoke: 18/18 í†µê³¼
- âœ… unit: 67/67 í†µê³¼ (logger í…ŒìŠ¤íŠ¸ ì¼ë¶€ í™˜ê²½ ì´ìŠˆ ìˆìŒ)
- âœ… styles: 219/219 í†µê³¼
- âœ… E2E ìŠ¤ëª¨í¬: 86/86 í†µê³¼
- âœ… ë¹Œë“œ: 345.68 KB (ì•ˆì •ì )
- âœ… validate: 0 ì—ëŸ¬

**ì„±ëŠ¥ ì˜í–¥**:

- âŒ í…ŒìŠ¤íŠ¸ ì†ë„ ì•½ 10-20% ê°ì†Œ (ìˆœì°¨ ì‹¤í–‰ + ë‹¨ì¼ ì›Œì»¤)
- âœ… ì•ˆì •ì„± ëŒ€í­ ê°œì„  (EPIPE 0ê±´)
- âœ… ë©”ëª¨ë¦¬ ì‚¬ìš© ì•ˆì •í™”

**ë³€ê²½ íŒŒì¼**:

- `package.json`: test ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì • (stdbuf, NODE_OPTIONS, ìˆœì°¨ ì‹¤í–‰)
- `vitest.config.ts`: poolOptions, singleThread: true ì„¤ì •

---
---

## ğŸ“‹ ì™„ë£Œëœ Phase ëª©ë¡ (ìš”ì•½)

| Phase | ìƒíƒœ    | ì£¼ìš” ì‘ì—…                   |
| ----- | ------- | --------------------------- |
| 277   | âœ… ì™„ë£Œ | í…ŒìŠ¤íŠ¸ í¬ê¸° ì •ì±… ì •ê·œí™”     |
| 276   | âœ… ì™„ë£Œ | EPIPE ì—ëŸ¬ ê·¼ë³¸ í•´ê²°        |
| 275   | âœ… ì™„ë£Œ | EPIPE ì—ëŸ¬ ì²« ì‹œë„ (ì¬ë°œìƒ) |
| 274   | âœ… ì™„ë£Œ | í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ìˆ˜ì •            |
| 273   | âœ… ì™„ë£Œ | jsdom ì•„í‹°íŒ©íŠ¸ ì œê±°         |
| 272   | âœ… ì™„ë£Œ | smoke í…ŒìŠ¤íŠ¸ ëª…í™•í™”         |
| 271   | âœ… ì™„ë£Œ | í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ê°œì„         |
| 270   | âœ… ì™„ë£Œ | ì´ë¯¸ì§€ ë¡œë“œ íƒ€ì´ë°          |
| 269   | âœ… ì™„ë£Œ | ê°¤ëŸ¬ë¦¬ ì´ˆê¸° ë†’ì´ ë¬¸ì œ       |
| 268   | âœ… ì™„ë£Œ | ëŸ°íƒ€ì„ ê²½ê³  ì œê±°            |
| 267   | âœ… ì™„ë£Œ | ë©”íƒ€ë°ì´í„° í´ë°± ê°•í™”        |
| 266   | âœ… ì™„ë£Œ | ìë™ ìŠ¤í¬ë¡¤ debounce        |
| 265   | âœ… ì™„ë£Œ | ìŠ¤í¬ë¡¤ ëˆ„ë½ ë²„ê·¸ ìˆ˜ì •       |
| 264   | âœ… ì™„ë£Œ | ìŠ¤í¬ë¡¤ ëª¨ì…˜ ì œê±°            |
| 263   | âœ… ì™„ë£Œ | ê¸°ë™ ìŠ¤í¬ë¡¤ ê°œì„             |
| 262   | âœ… ì™„ë£Œ | ìë™ ìŠ¤í¬ë¡¤ ë¶„ì„            |
| 261   | âœ… ì™„ë£Œ | dev ë¹Œë“œ ê°€ë…ì„±             |
| 260   | âœ… ì™„ë£Œ | ì˜ì¡´ì„± ì •ë¦¬                 |
| 258   | âœ… ì™„ë£Œ | ë¶€íŠ¸ìŠ¤íŠ¸ë© ìµœì í™”           |
| 257   | âœ… ì™„ë£Œ | events.ts ìµœì í™”            |
| 256   | âœ… ì™„ë£Œ | VerticalImageItem ìµœì í™”    |
| 255   | â¸ï¸ ë³´ë¥˜ | CSS ë ˆê±°ì‹œ í† í° ì •ë¦¬        |

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- **ì™„ë£Œ ê¸°ë¡**: [TDD_REFACTORING_PLAN_COMPLETED.md](./TDD_REFACTORING_PLAN_COMPLETED.md)
- **ê°œë°œ ê°€ì´ë“œ**: [AGENTS.md](../AGENTS.md)
- **ì•„í‚¤í…ì²˜**: [ARCHITECTURE.md](./ARCHITECTURE.md)
- **ì½”ë”© ê·œì¹™**: [CODING_GUIDELINES.md](./CODING_GUIDELINES.md)
- **í…ŒìŠ¤íŠ¸ ì „ëµ**: [TESTING_STRATEGY.md](./TESTING_STRATEGY.md)

---

ğŸ‰ **í”„ë¡œì íŠ¸ ì™„ì„±!** Phase 277 í…ŒìŠ¤íŠ¸ í¬ê¸° ì •ì±… ì •ê·œí™”ë¡œ ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
