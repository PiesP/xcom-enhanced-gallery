# TDD 리팩토링 활성 계획

> **현재 상태**: Solid.js 마이그레이션 완료, UX 개선 작업 진행 중
>
> **최종 업데이트**: 2025-10-10

---

## Phase 7: UX 개선 작업 🔄 진행 중

> Solid.js 마이그레이션 이후 발견된 사용성 이슈 해결

### 우선순위 1: 툴바 인디케이터 현재 포커스 자동 감지 회복 🔴 긴급

**증상**:

- 툴바의 숫자 인디케이터가 현재 스크롤 중인 이미지를 실시간으로 반영하지 못함
- `currentIndex`만 표시되고 `focusedIndex`는 표시되지 않음

**원인 분석**:

- `VerticalGalleryView.tsx`에서 `focusedIndex`를 로컬 상태로 관리
- `Toolbar` 컴포넌트에는 `currentIndex`만 props로 전달됨
- 스크롤 시 뷰포트에 보이는 이미지와 툴바 인디케이터 불일치

**솔루션 옵션**:

| 옵션 | 접근                                                        | 장점                          | 단점                         | 우선순위 |
| ---- | ----------------------------------------------------------- | ----------------------------- | ---------------------------- | -------- |
| A    | `focusedIndex`를 `galleryState`로 승격                      | 단일 진실 공급원, 자동 동기화 | 상태 구조 변경, 영향 범위 큼 | 장기     |
| B    | `VerticalGalleryView`에서 `focusedIndex`를 `Toolbar`에 전달 | 최소 변경, 빠른 수정          | prop drilling, 결합도 증가   | 단기 ✅  |
| C    | IntersectionObserver로 실시간 감지                          | 정확한 뷰포트 기준            | 성능 오버헤드, 복잡도 증가   | 추후     |

**선택된 솔루션**: B (단기) → A (장기)

**구현 단계**:

1. [x] 문제 진단 및 솔루션 분석
2. [ ] `Toolbar` 컴포넌트에 `focusedIndex` prop 추가
3. [ ] `VerticalGalleryView`에서 `focusedIndex` 전달 로직 구현
4. [ ] 툴바 인디케이터 표시 로직 수정 (`currentIndex` →
       `focusedIndex ?? currentIndex`)
5. [ ] 수동 테스트 (스크롤 시 인디케이터 변화 확인)
6. [ ] 단위 테스트 추가/수정

---

### 우선순위 2: 갤러리 마우스 휠 스크롤 활성화 🔴 긴급

**증상**:

- 갤러리 내에서 마우스 휠 스크롤이 동작하지 않음
- 키보드 네비게이션만 동작

**원인 분석**:

- `useGalleryScroll` 훅에서 wheel 이벤트는 감지됨
- `onScroll` 콜백이 전달되지만 실제 DOM 스크롤 처리가 없음
- 로깅만 수행하고 컨테이너를 스크롤하지 않음 (`VerticalGalleryView.tsx:219`)

**솔루션 옵션**:

| 옵션 | 접근                                         | 장점             | 단점                             | 우선순위 |
| ---- | -------------------------------------------- | ---------------- | -------------------------------- | -------- |
| A    | `onScroll` 콜백에서 `scrollBy` 직접 실행     | 간단하고 직관적  | 스크롤 로직 중복 가능성          | 단기 ✅  |
| B    | `useGalleryItemScroll`의 `scrollToItem` 연동 | 기존 로직 재사용 | wheel delta를 인덱스로 변환 필요 | 중기     |
| C    | 커스텀 스크롤 애니메이션 구현                | 부드러운 UX      | 복잡도 높음, 과도한 엔지니어링   | 낮음     |

**선택된 솔루션**: A (단기) → B (중기 최적화)

**구현 단계**:

1. [x] 문제 진단 및 솔루션 분석
2. [ ] `VerticalGalleryView.tsx`의 `onScroll` 콜백에 `scrollBy` 로직 추가
3. [ ] 스크롤 속도 조정 (delta \* multiplier)
4. [ ] 경계 체크 (overflow 방지)
5. [ ] 수동 테스트 (다양한 휠 스피드 확인)
6. [ ] 테스트 추가 (wheel 이벤트 시뮬레이션)

---

### 우선순위 3: 설정 모달 표시 위치 개선 🟡 중요

**증상**:

- 설정 모달이 왼쪽 상단에 표시됨
- 사용자가 인지하기 어려운 위치

**원인 분석**:

- `SettingsModal.tsx` 64줄에서 기본 `position`이 `'toolbar-below'`
- CSS에서 `.panel`의 기본 위치가 중앙이지만 position prop에 따라 달라짐
- 사용자의 기대: 화면 중앙 또는 툴바 근처

**솔루션 옵션**:

| 옵션 | 접근                              | 장점             | 단점              | 우선순위 |
| ---- | --------------------------------- | ---------------- | ----------------- | -------- |
| A    | 기본 position을 `'center'`로 변경 | 가장 간단        | 툴바 위치 무시    | 단기 ✅  |
| B    | 툴바 위치에 따라 동적 계산        | 문맥에 맞는 배치 | 복잡도 증가       | 중기     |
| C    | 사용자 설정에서 위치 선택 가능    | 최대 유연성      | 과도한 옵션, 혼란 | 낮음     |

**선택된 솔루션**: A (단기) → B (중기 개선)

**구현 단계**:

1. [x] 문제 진단 및 솔루션 분석
2. [ ] `SettingsModal.tsx` 64줄 기본값 `'toolbar-below'` → `'center'` 변경
3. [ ] CSS 확인 및 필요 시 조정
4. [ ] 수동 테스트 (다양한 화면 크기 확인)
5. [ ] 선택적: 툴바 위치 감지 로직 추가 (중기)

---

## 작업 우선순위 정리

### 즉시 착수 (P0)

1. 🔴 **툴바 인디케이터 포커스 감지** - 사용자 혼란 최소화
2. 🔴 **휠 스크롤 활성화** - 기본 기능 복구

### 다음 작업 (P1)

3. 🟡 **설정 모달 위치** - UX 개선

### 이후 작업 (P2)

- Phase 5-5: 테스트 타입 안정화 지속 (현재 1,383개 오류)
- Phase 5-6: Fast 테스트 통과율 100% 달성 (현재 95.0%)

---

## 개발 가이드라인

### TDD 접근

- 각 작업은 실패하는 테스트 작성 → 최소 구현 → 리팩토링 순서
- RED → GREEN → REFACTOR 사이클 준수

### 코딩 규칙 준수

- Solid.js Signals 사용: `getSolid()`, `getSolidStore()` getter 경유
- PC 전용 이벤트만 사용: click, keydown/up, wheel, contextmenu, mouse\*
- CSS Modules + 디자인 토큰만 사용 (하드코딩 금지)
- 경로 별칭 사용: `@`, `@features`, `@shared`, `@assets`

### 검증 절차

각 작업 완료 후:

```powershell
npm run typecheck  # TypeScript 타입 체크
npm run lint:fix   # ESLint 자동 수정
npm test:smoke     # 핵심 기능 스모크 테스트
npm run build      # dev/prod 빌드 검증
```

---

## 코드 품질 현황

### 마이그레이션 완료 현황

- ✅ **Phase 1-6**: Solid.js 전환, 테스트 인프라, 문서 정비 완료
- ✅ **빌드**: dev 711.28 KB / prod 성공
- ✅ **소스 코드**: 0 타입 오류 (TypeScript strict)
- ✅ **린트**: 0 warnings, 0 errors
- ✅ **의존성 그래프**: 1개 정보 메시지 (비크리티컬)

### 현재 테스트 상황

- ✅ Smoke 테스트: **15/15 통과** (100%)
- 🟡 Fast 테스트: **516/543 통과** (95.0%)
- 🟡 테스트 타입: 1,383개 오류 (테스트 파일만, src/ 코드는 0 오류)

### 기술 스택

- **UI**: Solid.js 1.9.9
- **상태**: Solid Signals (내장)
- **번들러**: Vite 7
- **타입**: TypeScript strict
- **테스트**: Vitest 3 + JSDOM

---

## 품질 게이트
