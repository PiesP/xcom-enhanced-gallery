# TDD 리팩토링 활성 계획

> **최종 업데이트**: 2025-10-18 | **상태**: Phase 102 완료, Phase 103+ 우선순위
> 재평가 필요 📋

## 프로젝트 현황

### 빌드 및 품질 지표

- **빌드**: 330.42 KB / 335 KB (4.58 KB 여유, 98.6%) ⚠️ 경고 기준(330 KB) 0.42
  KB 초과
- **타입**: TypeScript strict, 0 errors ✅
- **린트**: ESLint 0 warnings, Markdown 0 errors ✅
- **CSS 린트**: stylelint 0 warnings ✅
- **CodeQL**: 5/5 쿼리 통과, 병렬 실행 109.78초 ✅
- **의존성**: 0 violations (263 modules, 736 dependencies) ✅

### 테스트 현황

- **단위 테스트**: 1081 passing / 10 skipped (99.1% 통과율) ✅
- **E2E 테스트**: 28 passed / 1 skipped (96.6% 통과율) ✅
- **커버리지**: v8로 통일 완료, 45% 기준선 설정 ✅

### 코드 품질

- **로깅 일관성**: console 직접 사용 0건 (logger.ts 경유) ✅
- **디자인 토큰**: px 하드코딩 0개, rgba 0개, oklch 전용 ✅
- **브라우저 지원**: Safari 14+, Chrome 110+ (OKLCH 폴백 적용) ✅
- **타입 단언**: **27개** (Phase 102: 설계상 필수 8개 재분류, 실제 제거 2개) ⚠️

### 완료된 Phase (최근 6개)

| Phase | 주제                                       | 완료일     | 결과                                        |
| ----- | ------------------------------------------ | ---------- | ------------------------------------------- |
| 98    | Icon Registry 타입 안전성                  | 2025-10-17 | 타입 단언 5개 제거                          |
| 99    | Signal 타입 단언 제거                      | 2025-10-17 | 타입 단언 7개 제거 (38→31)                  |
| 100   | 타입 단언 전수 조사                        | 2025-10-17 | 31개 분석, 우선순위 결정                    |
| 101   | 즉시 제거 7개                              | 2025-10-17 | 타입 단언 7개 제거 (31→24), 22% 감소        |
| 102   | 검토 후 제거 가능 타입 단언 10개           | 2025-10-18 | 실제 2개 제거 (24→27), 8개 재분류           |
| 104.5 | 빌드 크기 최적화 (미사용 의존성 제거 시도) | 2025-10-18 | 효과 없음, 빌드 크기 330.42 KB 유지, 종료됨 |

> 상세 내용:
> [`TDD_REFACTORING_PLAN_COMPLETED.md`](./TDD_REFACTORING_PLAN_COMPLETED.md)

##

## 활성 Phase

### Phase 104: 큰 파일 재평가 (종료) ✅

**우선순위**: 중간 | **위험도**: 중간 | **상태**: 완료 - 현상 유지 결정

#### 재평가 결과 (2025-10-18)

**시도한 작업**:

- `media-url.util.ts` (16.60 KB) → 4개 모듈로 분해 시도
- 테스트 통과 (16 tests), 타입 체크 통과
- **실패 원인**: 순환 참조 발생 (`utils` → `media` → `utils`)

**분석 결과**:

| 파일                        | 크기     | 분해 가능성 | 판단 근거                           |
| --------------------------- | -------- | ----------- | ----------------------------------- |
| `events.ts`                 | 24.79 KB | ❌ 불가     | 순환 참조 위험 높음, 상태 공유 많음 |
| `url-patterns.ts`           | 23.17 KB | ❌ 불필요   | 정의 집합, 분해 시 복잡도만 증가    |
| `media-service.ts`          | 21.35 KB | ❌ 불필요   | Facade 패턴, 이미 잘 구조화됨       |
| `useGalleryFocusTracker.ts` | 19.68 KB | ❌ 불필요   | 단일 훅, 단일 책임                  |
| `media-url.util.ts`         | 16.60 KB | ⚠️ 위험     | 아키텍처 경계 위반 발생             |
| `settings-service.ts`       | 16.15 KB | ❌ 불필요   | 서비스, 단일 책임                   |

#### 핵심 교훈

1. **큰 파일이 반드시 나쁜 것은 아님**: 단일 책임을 가진 큰 파일은 오히려
   응집도가 높음
2. **아키텍처 경계가 우선**: 파일 크기보다 계층 간 의존성 방향이 더 중요
3. **정의 집합의 특수성**: URL 패턴 같은 정의 집합은 한 곳에 모아두는 것이
   유지보수에 유리
4. **순환 참조의 위험**: `utils` 레이어가 상위 레이어를 참조하면 순환 참조 발생
   가능

#### 결론

**Phase 104 종료**: 현재 파일 구조 유지

**이유**:

- ✅ 모든 품질 지표 우수 (타입 0 errors, 테스트 99.1% 통과)
- ✅ 빌드 크기 한계 근접 (330.42/335 KB, 98.6%)
- ✅ 의존성 검증 통과 (0 violations)
- ⚠️ 무리한 분해는 순환 참조 위험 증가

**대안**:

- 📝 큰 파일에 명확한 섹션 주석 추가
- 📚 복잡한 함수에 JSDoc 문서화 강화
- 🔍 실제 문제가 발생할 때만 리팩토링 (YAGNI 원칙)
- 📚 복잡한 함수에 JSDoc 문서화 강화
- 🔍 실제 문제가 발생할 때만 리팩토링 (YAGNI 원칙)

---

### Phase 105+: EventListener 타입 단언 개선 (장기) 🔧

**우선순위**: 낮음 | **위험도**: 높음 | **상태**: 보류

#### 현황

6개의 EventListener 타입 단언 발견:

- 브라우저 타입 불일치 (MouseEvent vs Event)
- Solid.js 이벤트 타입과 브라우저 이벤트 타입 간 차이

#### 보류 이유

| 이유              | 설명                                          |
| ----------------- | --------------------------------------------- |
| 타입 시스템 한계  | TypeScript의 EventListener 타입 정의가 제한적 |
| 브라우저 API 제약 | addEventListener는 Event 타입만 허용          |
| 우회 방법 복잡    | 래퍼 함수 추가 시 성능/복잡도 증가            |

#### 대안 검토

1. **타입 가드 함수**: 런타임 검증 추가 (오버헤드)
2. **제네릭 래퍼**: 타입 안전성 향상 (복잡도 증가)
3. **문서화**: 현재 상태 유지 + 주석 추가 (Phase 103 방식)

**결정**: Phase 103에서 문서화로 우선 대응

---

## 참고 문서

- **[TDD_REFACTORING_PLAN_COMPLETED.md](./TDD_REFACTORING_PLAN_COMPLETED.md)**:
  완료된 Phase 97-102 상세 기록
- **[AGENTS.md](../AGENTS.md)**: 개발 워크플로우, 스크립트 사용법
- **[ARCHITECTURE.md](./ARCHITECTURE.md)**: 3계층 구조
- **[CODING_GUIDELINES.md](./CODING_GUIDELINES.md)**: 코딩 규칙

> **업데이트**: 2025-10-18 | Phase 102 완료, 문서화 최신화

| ----------------------- | ---- | ---------------------------------- | |
EventListener 타입 변환 | 6 | 브라우저 타입 불일치 (시스템 설계) | | 브라우저
API 타입 확장 | 6 | GM\_\* API 타입 불완전성 | | 기타 타입 변환 | 3 | 서드파티
라이브러리 제약 |

> **상세 분석**:
> [`docs/phase-100-type-assertion-analysis.md`](./phase-100-type-assertion-analysis.md)

**재평가 조건**: 타입 시스템 한계 해결 또는 라이브러리 타입 개선 시 검토

##

## 유지 관리 모드 ✅

### 주요 활동

- 사용자 피드백 모니터링
- 버그 리포트 대응
- 의존성 보안 업데이트 (`npm audit`)
- 정기 유지보수 점검 (`npm run maintenance:check`)

### 경계 조건

| 지표           | 임계값     | 현재 상태               | 조치            |
| -------------- | ---------- | ----------------------- | --------------- |
| 번들 크기      | 335 KB     | 330.42 KB (98.6%)       | 4.58 KB 여유 ⚠️ |
| 테스트 Skipped | 20개       | 10개 (단위) + 1개 (E2E) | 정상 범위 ✅    |
| 테스트 통과율  | 95%        | 99.1% / 96.6%           | 우수 ✅         |
| 문서 크기      | 500줄/파일 | PLAN 830줄 → 신규 작성  | 간소화 완료 ✅  |

### 주기별 점검

**주간**: 번들 크기, 테스트 통과율, Skipped 수 **월간**: 의존성 보안, 문서
최신성, maintenance 점검 **분기**: 아키텍처 리뷰, 성능 벤치마크, 사용자 피드백
분석

##

## 참고 문서

- **[TDD_REFACTORING_PLAN_COMPLETED.md](./TDD_REFACTORING_PLAN_COMPLETED.md)**:
  완료된 Phase 97-101 상세 기록
- **[AGENTS.md](../AGENTS.md)**: 개발 워크플로우, 스크립트 사용법
- **[ARCHITECTURE.md](./ARCHITECTURE.md)**: 3계층 구조
- **[CODING_GUIDELINES.md](./CODING_GUIDELINES.md)**: 코딩 규칙
- **[TESTING_STRATEGY.md](./TESTING_STRATEGY.md)**: Testing Trophy, E2E 하네스
  패턴
- **[MAINTENANCE.md](./MAINTENANCE.md)**: 유지보수 체크리스트

##

> **유지보수 정책**: 이 문서는 활성 Phase만 포함. 완료 시 즉시
> `TDD_REFACTORING_PLAN_COMPLETED.md`로 이관. 500줄 초과 시 간소화 검토.
