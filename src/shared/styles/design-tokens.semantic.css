/**
 * @fileoverview Semantic Design Tokens
 * @description 역할 기반 토큰들 - primitive 값들을 참조
 */

:root {
  /* Background Colors - Semantic Roles */
  --color-bg-primary: var(--color-base-white);
  --color-bg-secondary: var(--color-gray-50);
  --color-bg-surface: var(--color-base-white);
  --color-bg-elevated: var(--color-base-white);

  /* 갤러리 및 툴바 배경 토큰 */
  --xeg-gallery-bg: var(--color-bg-primary);
  --xeg-bg-toolbar: var(--color-bg-surface);

  /* Text Colors - Semantic Roles */
  --color-text-primary: var(--color-base-black);
  --color-text-secondary: var(--color-gray-700);
  --color-text-muted: var(--color-gray-500);
  --color-text-inverse: var(--color-base-white);
  --color-text-error: var(--color-white-alpha-70);
  --color-text-on-overlay: var(--color-white-alpha-90);

  /* Border Colors - Semantic Roles */
  --color-border-default: var(--color-gray-200);
  --color-border-muted: var(--color-gray-100);
  --color-border-subtle: var(--color-gray-100);
  --color-border-emphasis: var(--color-gray-500);
  --color-border-primary: var(--color-border-default);
  --color-border-hover: var(--color-gray-300);

  /* State Colors - Semantic Roles */
  --color-success: var(--color-green-500);
  --color-success-hover: var(--color-green-600);
  --color-success-bg: var(--color-green-50);
  --color-error: var(--color-red-500);
  --color-error-hover: var(--color-red-600);
  --color-error-bg: var(--color-red-50);
  --color-warning: var(--color-yellow-500);
  --color-warning-bg: var(--color-yellow-50);
  --color-info: var(--color-blue-500);
  --color-info-bg: var(--color-blue-50);

  /* Interactive Colors - Semantic Roles */
  --color-primary: var(--color-twitter-blue);
  --color-primary-hover: var(--color-twitter-blue-hover);
  --color-primary-active: var(--color-twitter-blue-active);

  /* Overlay Colors - Epic CSS-TOKEN-UNIFY-001 Phase C */
  --color-overlay-light: rgba(0, 0, 0, var(--opacity-overlay-light));
  --color-overlay-medium: rgba(0, 0, 0, var(--opacity-overlay-medium));
  --color-overlay-strong: rgba(0, 0, 0, var(--opacity-overlay-strong));
  --color-overlay-backdrop: rgba(0, 0, 0, var(--opacity-overlay-backdrop));
  --color-overlay-light-bg: var(--color-white-alpha-95);
  --color-overlay-dark-bg: var(--color-black-alpha-95);
  --color-overlay-button-light: var(--color-black-alpha-10);
  --color-overlay-button-light-hover: var(--color-black-alpha-20);
  --xeg-color-overlay-dark: var(--color-black-alpha-95);
  --xeg-color-overlay-subtle: var(--color-white-alpha-10);

  /* Form Control Tokens */
  --xeg-form-control-bg: var(--xeg-color-neutral-100);
  --xeg-form-control-bg-hover: var(--xeg-color-neutral-200);
  --xeg-form-control-bg-active: var(--xeg-color-neutral-200);
  --xeg-form-control-border: var(--color-border-default);
  --xeg-form-control-border-hover: var(--color-border-hover);
  --xeg-form-control-border-active: var(--color-border-hover);
  --xeg-form-control-checked-bg: var(--color-primary);
  --xeg-form-control-checked-border: var(--color-primary);
  --xeg-form-control-color: var(--color-text-primary);
  --xeg-form-control-color-hover: var(--color-text-primary);
  --xeg-form-control-accent: var(--color-primary);
  --xeg-form-control-check-color: var(--color-base-white);
  --xeg-form-control-check-weight: 2px;
  /* NOTE: Epic CSS-TOKEN-UNIFY-001 Phase B - primitive 토큰 직접 사용 */
  --xeg-form-control-radius: var(--radius-md);
  --xeg-form-control-shadow: none;
  --xeg-form-control-shadow-hover: var(--xeg-shadow-xs);
  --xeg-form-control-shadow-active: var(--xeg-shadow-xs);
  --xeg-form-control-disabled-opacity: var(--xeg-opacity-disabled);
  --xeg-form-control-focus-outline: var(--xeg-focus-ring);
  --xeg-form-control-focus-offset: var(--xeg-focus-ring-offset);
  --xeg-form-control-padding-block: 0.375em;
  --xeg-form-control-padding-inline: 0.75em;
  --xeg-form-control-gap: var(--xeg-spacing-xs);
  --xeg-form-control-font-size: var(--xeg-font-size-sm);
  --xeg-form-control-font-weight: var(--xeg-font-weight-medium);
  --xeg-form-control-toggle-size: 1.125em;

  /* Glass Effect - Epic CSS-TOKEN-UNIFY-001 Phase C */
  --color-glass-bg: rgba(255, 255, 255, var(--opacity-glass));
  --color-glass-border: var(--color-white-alpha-20);

  /* Spacing - Semantic Roles */
  --spacing-component-padding: var(--space-md);
  --spacing-component-margin: var(--space-sm);
  --spacing-section-gap: var(--space-lg);
  --spacing-item-gap: var(--space-sm);

  /* Component Sizing - Semantic Roles */
  --size-button-height: 40px;
  --size-input-height: 40px;
  --size-icon-sm: 16px;
  --size-icon-md: 20px;
  --size-icon-lg: 24px;

  /* Animation - Semantic Roles */
  --transition-fast: var(--duration-fast) cubic-bezier(0.4, 0, 0.2, 1);
  --transition-normal: var(--duration-normal) cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: var(--duration-slow) cubic-bezier(0.4, 0, 0.2, 1);

  /* Shadows - Epic CSS-TOKEN-UNIFY-001 Phase C */
  --shadow-sm: 0 1px 2px var(--color-black-alpha-5);
  --shadow-md: 0 4px 12px var(--color-black-alpha-15);
  --shadow-lg: 0 8px 32px var(--color-black-alpha-15);
  --shadow-xl: 0 4px 20px var(--color-black-alpha-30);
  --shadow-gallery-image: var(--shadow-xl);
  --shadow-gallery-nav: var(--shadow-md);
  --shadow-thumbnail: 0 2px 8px var(--color-slate-alpha-8);
  --shadow-thumbnail-hover: 0 4px 16px var(--color-slate-alpha-12);

  /* Legacy Shadow Tokens - 호환성 보장 */
  --xeg-shadow-sm: var(--shadow-sm);
  --xeg-shadow-md: var(--shadow-md);
  --xeg-shadow-lg: var(--shadow-lg);

  /* Focus & Accessibility */
  --xeg-focus-outline: 2px solid var(--color-primary);
  --xeg-focus-offset: 2px;

  /* Z-Index Management */
  /* Base overlay/modal/toolbar/toast z-index tokens */
  --xeg-z-modal: 10000;
  --xeg-z-toolbar: 10001;
  --xeg-z-overlay: 9999;
  --xeg-z-toast: 10080;
  /* Gallery overlay (alias of overlay) */
  --xeg-z-gallery: var(--xeg-z-overlay);
  /* Isolated root container (userscript) — must be above all site UI */
  --xeg-z-root: 2147483647;

  /* Layer Management - Semantic Roles */
  --xeg-layer-base: 0;
  --xeg-layer-toolbar: var(--xeg-z-toolbar);
  --xeg-layer-modal: var(--xeg-z-modal);
  --xeg-layer-overlay: var(--xeg-z-overlay);
  --xeg-layer-toast: var(--xeg-z-toast);
  --xeg-layer-root: var(--xeg-z-root);

  /* Animation Timing - Semantic Roles */
  --xeg-anim-duration: var(--duration-normal);
  --xeg-duration: var(--duration-normal);
  --xeg-duration-fast: var(--duration-fast);
  --xeg-duration-slow: var(--duration-slow);

  /* Animation Easing */
  --xeg-easing-ease-out: cubic-bezier(0.4, 0, 0.2, 1);
  --xeg-easing-ease-in: cubic-bezier(0.4, 0, 1, 1);
  --xeg-easing-ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);

  /* Interaction State Tokens */
  --xeg-button-lift: -1px;
  --xeg-button-lift-hover: -2px;
  --xeg-opacity-disabled: 0.5;
  --xeg-opacity-hover: 0.8;

  /* Surface Glass - Unified Tokens */
  --xeg-surface-glass-bg: var(--color-glass-bg);
  --xeg-surface-glass-border: var(--color-glass-border);
  --xeg-surface-glass-shadow: var(--shadow-lg);

  /* Surface Glass - Unified Tokens */
  --xeg-surface-glass-bg: var(--color-glass-bg);
  --xeg-surface-glass-border: var(--color-glass-border);
  --xeg-surface-glass-shadow: var(--shadow-lg);

  /* Surface Glass Hover States - Epic CSS-TOKEN-UNIFY-001 Phase C */
  --xeg-surface-glass-bg-hover: var(--color-white-alpha-15);
  --xeg-surface-glass-shadow-hover:
    0 8px 32px var(--color-black-alpha-20), 0 4px 16px var(--color-black-alpha-10);

  /* NOTE: Border Radius alias 제거 (Epic CSS-TOKEN-UNIFY-001 Phase B)
   * 컴포넌트는 semantic layer의 --radius-* 토큰을 직접 사용해야 함
   * 예: var(--radius-md), var(--radius-lg) 등
   */
}

/* Theme Support - Dark/Light Mode */
[data-theme='light'] {
  --color-bg-primary: var(--color-base-white);
  --color-text-primary: var(--color-base-black);
  --color-glass-bg: rgba(255, 255, 255, var(--opacity-glass));

  /* 라이트 모드 컴포넌트 토큰 - Epic CSS-TOKEN-UNIFY-001 Phase C */
  --xeg-comp-toolbar-bg: var(--color-bg-surface);
  --xeg-surface-glass-bg-light: var(--color-white-alpha-95);
  --xeg-surface-glass-text-light: var(--color-text-primary);
  --xeg-surface-glass-border-light: var(--color-border-default);
}

/* Epic THEME-ICON-UNIFY-001 Phase A-2: 라이트 테마 토큰 확장 */
[data-theme='light'] {
  --color-bg-primary: var(--color-base-white);
  --color-bg-secondary: var(--color-gray-50);
  --color-bg-surface: var(--color-base-white);
  --color-text-primary: var(--color-base-black);
  --color-border-primary: var(--color-gray-200);
  --xeg-bg-toolbar: var(--color-base-white);

  /* Toolbar 전용 토큰 */
  --xeg-toolbar-bg: var(--color-base-white);
  --xeg-toolbar-border: var(--color-gray-200);
  --xeg-toolbar-shadow: var(--shadow-md);

  /* Settings 전용 토큰 */
  --xeg-settings-bg: var(--color-base-white);
  --xeg-settings-border: var(--color-gray-200);

  /* Toast 전용 토큰 */
  --xeg-toast-bg-info: var(--color-blue-50);
  --xeg-toast-bg-success: var(--color-green-50);
  --xeg-toast-bg-warning: var(--color-yellow-50);
  --xeg-toast-bg-error: var(--color-red-50);
}

/* Epic THEME-ICON-UNIFY-001 Phase A-2: 다크 테마 토큰 확장 */
[data-theme='dark'] {
  --color-bg-primary: var(--color-gray-900);
  --color-bg-secondary: var(--color-gray-800);
  --color-text-primary: var(--color-base-white);
  --color-border-primary: var(--color-gray-700);
  --color-glass-bg: rgba(0, 0, 0, var(--opacity-glass));

  --xeg-form-control-bg: var(--xeg-color-neutral-800);
  --xeg-form-control-bg-hover: var(--xeg-color-neutral-700);
  --xeg-form-control-bg-active: var(--xeg-color-neutral-700);
  --xeg-form-control-border: var(--xeg-color-neutral-600);
  --xeg-form-control-border-hover: var(--xeg-color-neutral-500);
  --xeg-form-control-border-active: var(--xeg-color-neutral-500);
  --xeg-form-control-checked-bg: var(--color-primary);
  --xeg-form-control-checked-border: var(--color-primary);
  --xeg-form-control-color: var(--color-text-primary);
  --xeg-form-control-color-hover: var(--color-text-primary);
  --xeg-form-control-shadow: 0 0 0 1px var(--color-white-alpha-6);
  --xeg-form-control-shadow-hover: 0 2px 6px var(--color-black-alpha-35);
  --xeg-form-control-shadow-active: 0 0 0 1px var(--color-white-alpha-8);

  /* 다크 테마 갤러리 배경 */
  --xeg-gallery-bg: var(--color-gray-900);
  --xeg-bg-toolbar: var(--color-gray-800);

  /* Toolbar 전용 토큰 (다크) */
  --xeg-toolbar-bg: var(--color-gray-800);
  --xeg-toolbar-border: var(--color-gray-700);
  --xeg-toolbar-shadow: 0 4px 12px var(--color-black-alpha-30);

  /* Settings 전용 토큰 (다크) */
  --xeg-settings-bg: var(--color-gray-800);
  --xeg-settings-border: var(--color-gray-700);

  /* Toast 전용 토큰 (다크) */
  --xeg-toast-bg-info: var(--color-gray-700);
  --xeg-toast-bg-success: var(--color-gray-700);
  --xeg-toast-bg-warning: var(--color-gray-700);
  --xeg-toast-bg-error: var(--color-gray-700);

  /* 다크 모드 컴포넌트 토큰 - Epic CSS-TOKEN-UNIFY-001 Phase C */
  --xeg-comp-toolbar-bg: var(--color-dark-alpha-95);
  --xeg-surface-glass-bg-dark: var(--color-dark-alpha-95);
  --xeg-surface-glass-text-dark: var(--color-text-inverse);
  --xeg-surface-glass-border-dark: var(--color-white-alpha-20);
  --xeg-surface-glass-shadow: 0 8px 32px var(--color-black-alpha-60);
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) {
    --color-bg-primary: var(--color-gray-900);
    --color-bg-secondary: var(--color-gray-800);
    --color-text-primary: var(--color-base-white);
    --color-border-primary: var(--color-gray-700);
    --color-glass-bg: rgba(0, 0, 0, var(--opacity-glass));

    /* prefers-color-scheme 다크 모드 갤러리 배경 - Epic CSS-TOKEN-UNIFY-001 Phase C */
    --xeg-gallery-bg: var(--color-gray-900);
    --xeg-bg-toolbar: var(--color-gray-800);
    --xeg-surface-glass-bg: var(--color-dark-alpha-95);

    /* Toolbar 전용 토큰 (prefers-color-scheme dark) */
    --xeg-toolbar-bg: var(--color-gray-800);
    --xeg-toolbar-border: var(--color-gray-700);
    --xeg-toolbar-shadow: 0 4px 12px var(--color-black-alpha-30);

    /* Settings 전용 토큰 (prefers-color-scheme dark) */
    --xeg-settings-bg: var(--color-gray-800);
    --xeg-settings-border: var(--color-gray-700);

    /* Toast 전용 토큰 (prefers-color-scheme dark) */
    --xeg-toast-bg-info: var(--color-gray-700);
    --xeg-toast-bg-success: var(--color-gray-700);
    --xeg-toast-bg-warning: var(--color-gray-700);
    --xeg-toast-bg-error: var(--color-gray-700);
    /* 모달 토큰은 하단 시스템 테마 블록에서 var 매핑으로 일관 처리 */
  }
}

@media (prefers-contrast: high) {
  :root {
    --xeg-focus-outline: 3px solid var(--color-primary);
    --color-border-emphasis: var(--color-base-black);
    --xeg-form-control-bg: Canvas;
    --xeg-form-control-bg-hover: Canvas;
    --xeg-form-control-bg-active: Canvas;
    --xeg-form-control-border: CanvasText;
    --xeg-form-control-border-hover: CanvasText;
    --xeg-form-control-border-active: CanvasText;
    --xeg-form-control-checked-bg: CanvasText;
    --xeg-form-control-checked-border: CanvasText;
    --xeg-form-control-check-color: Canvas;
    --xeg-color-overlay-dark: CanvasText;
    --xeg-color-overlay-subtle: Canvas;
  }
}

@media (prefers-reduced-motion: reduce) {
  :root {
    --xeg-duration: 0ms;
    --transition-fast: 0ms;
    --transition-normal: 0ms;
    --transition-slow: 0ms;
  }
}

/* Component Scope Tokens */
:root {
  /* Toolbar Component Tokens */
  --xeg-comp-toolbar-bg: var(--color-bg-surface);
  --xeg-comp-toolbar-border: var(--color-border-default);
  --xeg-comp-toolbar-shadow: var(--shadow-md);
  /* NOTE: Epic CSS-TOKEN-UNIFY-001 Phase B - primitive 토큰 직접 사용 */
  --xeg-comp-toolbar-radius: var(--radius-lg);
  --xeg-comp-toolbar-z-index: var(--xeg-layer-toolbar);

  /* Modal Component Tokens */
  /* NOTE: Modal component tokens now defer to semantic tokens to avoid
    cascading alias overwrite issues that previously caused dark mode
    transparency regressions (see 2025-09-11 fix log). */
  --xeg-comp-modal-bg: var(--xeg-modal-bg);
  --xeg-comp-modal-border: var(--xeg-modal-border);
  --xeg-comp-modal-shadow: var(--shadow-lg);
  /* NOTE: Epic CSS-TOKEN-UNIFY-001 Phase B - primitive 토큰 직접 사용 */
  --xeg-comp-modal-radius: var(--radius-xl);
  --xeg-comp-modal-z-index: var(--xeg-layer-modal);
  --xeg-comp-modal-backdrop: var(--color-overlay-backdrop);
  /* Semantic tokens (authoritative) defined later in file control actual values */

  /* Toast Component Tokens */
  --xeg-toast-bg-info: oklch(0.95 0.05 237.8);
  --xeg-toast-border-info: oklch(0.676 0.151 237.8);
  --xeg-toast-bg-success: oklch(0.95 0.08 142);
  --xeg-toast-border-success: oklch(0.725 0.17 142.5);
  --xeg-toast-bg-warning: oklch(0.988 0.029 86.7);
  --xeg-toast-border-warning: oklch(0.761 0.16 70.7);
  --xeg-toast-bg-error: oklch(0.971 0.013 17.4);
  --xeg-toast-border-error: oklch(0.628 0.257 27.3);
  --xeg-toast-bg-neutral: oklch(0.943 0.006 206.2);
  --xeg-toast-shadow-info: 0 2px 8px oklch(0.676 0.151 237.8 / 0.15);
  --xeg-toast-shadow-focus: 0 4px 16px oklch(0.676 0.151 237.8 / 0.25);

  /* Focus Ring Utilities */
  --xeg-focus-ring: 2px solid oklch(0.676 0.151 237.8);
  --xeg-focus-ring-offset: 2px;
  --xeg-focus-ring-color: oklch(0.676 0.151 237.8);
  --xeg-focus-ring-width: 2px;

  /* 갤러리 테마별 배경 토큰 */
  --xeg-gallery-bg-light: var(--color-bg-primary);
  --xeg-gallery-bg-dark: var(--color-gray-900);
  --xeg-gallery-bg: var(--xeg-gallery-bg-dark); /* 기본값: 다크 */

  /* 모달 테마별 배경 토큰 - Epic CSS-TOKEN-UNIFY-001 Phase C */
  --xeg-modal-bg-light: var(--color-bg-surface);
  --xeg-modal-bg-dark: var(--color-dark-alpha-98);
  --xeg-modal-bg: var(--xeg-modal-bg-light); /* 기본값: 라이트 */
  --xeg-modal-border-light: var(--color-border-default);
  --xeg-modal-border-dark: var(--color-white-alpha-15);
  --xeg-modal-border: var(--xeg-modal-border-light);
}

/* 테마별 토큰 오버라이드 */
[data-theme='light'] {
  --xeg-gallery-bg: var(--xeg-gallery-bg-light);
  --xeg-modal-bg: var(--xeg-modal-bg-light);
  --xeg-modal-border: var(--xeg-modal-border-light);
}

[data-theme='dark'] {
  --xeg-gallery-bg: var(--xeg-gallery-bg-dark);
  --xeg-modal-bg: var(--xeg-modal-bg-dark);
  --xeg-modal-border: var(--xeg-modal-border-dark);

  /* 다크 테마 Glass Surface 시인성 개선 - Epic CSS-TOKEN-UNIFY-001 Phase C */
  --xeg-surface-glass-bg: var(--color-dark-alpha-95);
  --xeg-surface-glass-bg-dark: var(--color-dark-alpha-95);
  --xeg-surface-glass-border-dark: var(--color-white-alpha-20);
  --xeg-surface-glass-shadow: 0 8px 32px var(--color-black-alpha-60);
}

/* 시스템 테마 기본 지원 */
@media (prefers-color-scheme: light) {
  :root:not([data-theme='dark']) {
    --xeg-gallery-bg: var(--xeg-gallery-bg-light);
    --xeg-modal-bg: var(--xeg-modal-bg-light);
    --xeg-modal-border: var(--xeg-modal-border-light);
  }
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) {
    --xeg-gallery-bg: var(--xeg-gallery-bg-dark);
    --xeg-modal-bg: var(--xeg-modal-bg-dark);
    --xeg-modal-border: var(--xeg-modal-border-dark);
  }
}

/* ===== 유틸리티 클래스 ===== */

/* Toast 애니메이션 토큰 */
.xeg-anim-slide-in {
  animation: slideInFromRight var(--xeg-duration-fast) var(--xeg-ease-standard);
  will-change: transform, opacity;
  backface-visibility: hidden;
}

.xeg-anim-fade-slide-in {
  animation: fadeSlideIn var(--xeg-duration-normal) var(--xeg-ease-standard);
  will-change: transform, opacity;
  backface-visibility: hidden;
}

/* Toast GPU 가속 keyframes */
@keyframes slideInFromRight {
  from {
    transform: translateX(100%) translateZ(0);
    opacity: 0;
  }
  to {
    transform: translateX(0) translateZ(0);
    opacity: 1;
  }
}

@keyframes fadeSlideIn {
  from {
    transform: translateY(-0.5rem) translateZ(0);
    opacity: 0;
  }
  to {
    transform: translateY(0) translateZ(0);
    opacity: 1;
  }
}

/* Focus Ring 유틸리티 클래스 */
.xeg-focus-ring {
  outline: var(--xeg-focus-ring);
  outline-offset: var(--xeg-focus-ring-offset);
}

.xeg-focus-ring:focus-visible {
  outline: var(--xeg-focus-ring);
  outline-offset: var(--xeg-focus-ring-offset);
}
