/**
 * @fileoverview 최신 CSS 기능 활용
 * @description CSS Color Module, Container Queries, CSS Subgrid 등 최신 기능
 * @version 1.0.0
 */

/**
 * CSS Color Module Level 4 활용
 * oklch() 색상 공간을 사용한 더 나은 색상 정의
 */
:root {
  /* OKLCH 색상 공간 - 더 자연스러운 색상 보간 */
  --xeg-color-primary-oklch: oklch(70% 0.15 220deg);
  --xeg-color-primary-hover-oklch: oklch(65% 0.15 220deg);
  --xeg-color-accent-oklch: oklch(80% 0.12 180deg);

  /* 동적 색상 보간 */
  --xeg-color-primary-gradient: linear-gradient(
    45deg,
    var(--xeg-color-primary-oklch),
    color-mix(in oklch, var(--xeg-color-primary-oklch) 80%, white)
  );

  /* 상대적 색상 구문 (Relative Color Syntax) */
  --xeg-color-primary-light: oklch(from var(--xeg-color-primary-oklch) calc(l + 0.2) c h);
  --xeg-color-primary-dark: oklch(from var(--xeg-color-primary-oklch) calc(l - 0.2) c h);
}

/**
 * CSS Grid Subgrid 활용
 */
.xeg-gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(17.5rem, 1fr)); /* 280px */
  grid-template-rows: repeat(auto-fit, minmax(12.5rem, auto)); /* 200px */
  gap: var(--xeg-spacing-md);

  /* Container Queries 지원 */
  container-type: size;
  container-name: gallery-grid;
}

.xeg-gallery-item {
  display: grid;
  grid-template-rows: subgrid;
  grid-row: span 3;

  /* Subgrid를 통한 정렬 */
  grid-template-areas:
    'header'
    'content'
    'footer';
}

.xeg-gallery-item-header {
  grid-area: header;
}

.xeg-gallery-item-content {
  grid-area: content;
}

.xeg-gallery-item-footer {
  grid-area: footer;
}

/**
 * Container Queries 확장
 */
@container gallery-grid (width > 48rem) {
  /* 768px */
  .xeg-gallery-grid {
    grid-template-columns: repeat(auto-fit, minmax(21.875rem, 1fr)); /* 350px */
    gap: var(--xeg-spacing-lg);
  }
}

@container gallery-grid (width > 75rem) {
  /* 1200px */
  .xeg-gallery-grid {
    grid-template-columns: repeat(auto-fit, minmax(25rem, 1fr)); /* 400px */
    gap: var(--xeg-spacing-xl);
  }
}

@container gallery-grid (height > 50rem) {
  /* 800px */
  .xeg-gallery-item {
    grid-template-rows: subgrid;
    grid-row: span 4; /* 더 많은 공간 활용 */
  }
}

/**
 * CSS Nesting 활용
 */
.xeg-toolbar {
  background: var(--xeg-color-surface);
  border-radius: var(--xeg-radius-lg);
  padding: var(--xeg-spacing-md);

  /* Nesting으로 가독성 향상 - ToolbarButton.module.css로 통합됨 */
  /* @deprecated - ToolbarButton.module.css의 .toolbarButton 사용 권장 */

  & .toolbar-separator {
    width: 0.0625rem; /* 1px */
    height: 1.5rem; /* 24px */
    background: var(--xeg-color-border-secondary);
    margin: 0 var(--xeg-spacing-sm);
  }
}

/**
 * CSS Logical Properties 활용
 */
.xeg-content {
  padding-block: var(--xeg-spacing-lg);
  padding-inline: var(--xeg-spacing-md);
  margin-block-start: var(--xeg-spacing-md);
  border-inline-start: 0.125rem solid var(--xeg-color-border-primary); /* 2px */
}

/**
 * 고급 CSS 선택자 활용
 */
/* :has() 선택자 */
.xeg-gallery-container:has(.xeg-toolbar:hover) {
  --toolbar-interaction: 1;
}

.xeg-gallery-container:has(.xeg-item:focus-visible) {
  --has-focused-item: 1;
}

/* :where() 선택자로 우선순위 조정 */
:where(.xeg-button) {
  background: var(--xeg-color-surface);
  border: 0.0625rem solid var(--xeg-color-border-primary); /* 1px */
  border-radius: var(--xeg-radius-md);
  padding: var(--xeg-spacing-sm) var(--xeg-spacing-md);
}

/* :is() 선택자로 그룹화 */
:is(.xeg-primary, .xeg-secondary, .xeg-tertiary) {
  font-weight: var(--xeg-font-weight-medium);
  transition:
    background-color var(--xeg-duration-fast) var(--xeg-ease-standard),
    border-color var(--xeg-duration-fast) var(--xeg-ease-standard),
    color var(--xeg-duration-fast) var(--xeg-ease-standard),
    box-shadow var(--xeg-duration-fast) var(--xeg-ease-standard),
    transform var(--xeg-duration-fast) var(--xeg-ease-standard);
}

/**
 * View Transitions API 준비
 */
.xeg-gallery-transition {
  view-transition-name: gallery-main;
}

.xeg-gallery-item-transition {
  view-transition-name: var(--item-transition-name);
}

/* View Transition 스타일 */
::view-transition-old(gallery-main) {
  animation: slideOut var(--xeg-duration-normal) var(--xeg-ease-standard);
}

::view-transition-new(gallery-main) {
  animation: slideIn var(--xeg-duration-normal) var(--xeg-ease-standard);
}

@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(-100%);
    opacity: 0;
  }
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/**
 * CSS Anchor Positioning (미래 기능 준비)
 */
.xeg-tooltip {
  position: absolute;
  position-anchor: --tooltip-anchor;
  inset-area: top;
  margin-bottom: 0.5rem; /* 8px */
}

/**
 * 폴백 지원
 * Note: OKLCH 색상 폴백은 PostCSS 플러그인(@csstools/postcss-oklab-function)이 자동 생성
 */
@supports not (container-type: size) {
  .xeg-gallery-grid {
    /* 미디어 쿼리 폴백 */
  }
}

@supports not (display: subgrid) {
  .xeg-gallery-item {
    display: flex;
    flex-direction: column;
  }
}
